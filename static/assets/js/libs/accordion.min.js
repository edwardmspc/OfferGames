//Original: http://www.oaa-accessibility.org/examplep/accordian1/
// keyCodes() is an object to contain keycodes needed for the application
function keyCodes(){this.tab=9;this.enter=13;this.esc=27;this.space=32;this.pageup=33;this.pagedown=34;this.end=35;this.home=36;this.left=37;this.up=38;this.right=39;this.down=40}function tabpanel(e,t){this.panel_id=e;this.accordian=t;this.$panel=$("#"+e);this.keys=new keyCodes;this.$tabs=this.$panel.find('[role="tab"]');this.$panels=this.$panel.children('[role="tabpanel"]');this.bindHandlers();this.init()}tabpanel.prototype.init=function(){var e;this.$panels.attr("aria-hidden","true");this.$panels.hide();e=this.$tabs.filter(".selected");if(e==undefined){e=this.$tabs.first();e.addClass("selected")}this.$panel.find("#"+e.attr("aria-controls")).show().attr("aria-hidden","false")};tabpanel.prototype.switchTabs=function(e,t){e.removeClass("selected focus");e.attr("tabindex","-1").attr("aria-selected","false");t.addClass("selected").attr("aria-selected","true");if(this.accordian==0){this.$panel.find("#"+e.attr("aria-controls")).hide().attr("aria-hidden","true");e.attr("aria-expanded","false");this.$panel.find("#"+t.attr("aria-controls")).show().attr("aria-hidden","false");t.attr("aria-expanded","true");this.$focusable.length=0;this.$panels.find(":focusable")}t.attr("tabindex","0");t.focus()};tabpanel.prototype.togglePanel=function(e){$panel=this.$panel.find("#"+e.attr("aria-controls"));if($panel.attr("aria-hidden")=="true"){$panel.attr("aria-hidden","false");$panel.slideDown(100);e.attr("aria-expanded","true")}else{$panel.attr("aria-hidden","true");$panel.slideUp(100);e.attr("aria-expanded","false")}};tabpanel.prototype.bindHandlers=function(){var e=this;this.$tabs.keydown(function(t){return e.handleTabKeyDown($(this),t)});this.$tabs.keypress(function(t){return e.handleTabKeyPress($(this),t)});this.$tabs.click(function(t){return e.handleTabClick($(this),t)});this.$tabs.focus(function(t){return e.handleTabFocus($(this),t)});this.$tabs.blur(function(t){return e.handleTabBlur($(this),t)});this.$panels.keydown(function(t){return e.handlePanelKeyDown($(this),t)});this.$panels.keypress(function(t){return e.handlePanelKeyPress($(this),t)});this.$panels.click(function(t){return e.handlePanelClick($(this),t)})};tabpanel.prototype.handleTabKeyDown=function(e,t){if(t.altKey)return!0;switch(t.keyCode){case this.keys.enter:case this.keys.space:if(this.accordian==1){this.togglePanel(e);t.stopPropagation();return!1}return!0;case this.keys.left:case this.keys.up:var n=this,r,i;if(!t.ctrlKey){var s=this.$tabs.index(e);s==0?i=this.$tabs.last():i=this.$tabs.eq(s-1);this.switchTabs(e,i)}t.stopPropagation();return!1;case this.keys.right:case this.keys.down:var n=this,o=!1,i,s=this.$tabs.index(e);s==this.$tabs.length-1?i=this.$tabs.first():i=this.$tabs.eq(s+1);this.switchTabs(e,i);t.stopPropagation();return!1;case this.keys.home:this.switchTabs(e,this.$tabs.first());t.stopPropagation();return!1;case this.keys.end:this.switchTabs(e,this.$tabs.last());t.stopPropagation();return!1}};tabpanel.prototype.handleTabKeyPress=function(e,t){if(t.altKey)return!0;switch(t.keyCode){case this.keys.enter:case this.keys.space:case this.keys.left:case this.keys.up:case this.keys.right:case this.keys.down:case this.keys.home:case this.keys.end:t.stopPropagation();return!1;case this.keys.pageup:case this.keys.pagedown:if(!t.ctrlKey)return!0;t.stopPropagation();return!1}return!0};tabpanel.prototype.handleTabClick=function(e,t){e.attr("tabindex","0").attr("aria-selected","true").addClass("selected");this.$tabs.not(e).attr("tabindex","-1").attr("aria-selected","false").removeClass("selected");this.togglePanel(e);t.stopPropagation();return!1};tabpanel.prototype.handleTabFocus=function(e,t){e.addClass("focus");return!0};tabpanel.prototype.handleTabBlur=function(e,t){e.removeClass("focus");return!0};tabpanel.prototype.handlePanelKeyDown=function(e,t){if(t.altKey)return!0;switch(t.keyCode){case this.keys.tab:var n=e.find(":focusable"),r=n.index($(t.target)),i=this.$panels.index(e),s=this.$panels.length;if(t.shiftKey){if(r==0&&i>0)for(var o=i-1;o>=0;o--){var u=this.$panels.eq(o),a=$("#"+u.attr("aria-labelledby"));n.length=0;n=u.find(":focusable");if(n.length>0){n.last().focus();this.$tabs.attr("aria-selected","false").removeClass("selected");a.attr("aria-selected","true").addClass("selected");t.stopPropagation;return!1}}}else if(i<s&&r==n.length-1)for(var o=i+1;o<s;o++){var f=this.$panels.eq(o),l=$("#"+f.attr("aria-labelledby"));n.length=0;n=f.find(":focusable");if(n.length>0){n.first().focus();this.$tabs.attr("aria-selected","false").removeClass("selected");l.attr("aria-selected","true").addClass("selected");t.stopPropagation;return!1}}break;case this.keys.left:case this.keys.up:if(!t.ctrlKey)return!0;var c=$("#"+e.attr("aria-labelledby"));c.focus();t.stopPropagation();return!1;case this.keys.pageup:var h;if(!t.ctrlKey)return!0;var c=this.$tabs.filter(".selected"),r=this.$tabs.index(c);r==0?h=this.$tabs.last():h=this.$tabs.eq(r-1);this.switchTabs(c,h);t.stopPropagation();t.preventDefault();return!1;case this.keys.pagedown:var h;if(!t.ctrlKey)return!0;var c=$("#"+e.attr("aria-labelledby")),r=this.$tabs.index(c);r==this.$tabs.length-1?h=this.$tabs.first():h=this.$tabs.eq(r+1);this.switchTabs(c,h);t.stopPropagation();t.preventDefault();return!1}return!0};tabpanel.prototype.handlePanelKeyPress=function(e,t){if(t.altKey)return!0;if(!t.ctrlKey||t.keyCode!=this.keys.pageup&&t.keyCode!=this.keys.pagedown){switch(t.keyCode){case this.keys.esc:t.stopPropagation();t.preventDefault();return!1}return!0}t.stopPropagation();t.preventDefault();return!1};tabpanel.prototype.handlePanelClick=function(e,t){var n=$("#"+e.attr("aria-labelledby"));n.attr("tabindex","0").attr("aria-selected","true").addClass("selected");this.$tabs.not(n).attr("tabindex","-1").attr("aria-selected","false").removeClass("selected");return!0};$.extend($.expr[":"],{focusable:function(e){var t=e.nodeName.toLowerCase(),n=$(e).attr("tabindex");return $(e)[t=="area"?"parents":"closest"](":hidden").length==1?!1:!isNaN(n)&&n<0?!1:/input|select|textarea|button|object/.test(t)==1?!e.disabled:(t=="a"||t=="area")==1?e.href.length>0:!1}});
